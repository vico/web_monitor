{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Trade history - Index{% endblock %}

{% block page_content %}
<div class="page-header">
    <h2 style="display:inline-block;">{{params['name']}} ({{params['quick']}})</h2> 
     <form class="form-inline" style="display:inline-block;float:right;" method="GET" action="check">
        <div class="form-group">
            <label for="quick">Quick</label>
            <input type="text" class="form-control" id="quick" name="quick" placeholder="7200 or 711 HK or HACK US" autofocus>
        </div>
        <button type="submit" class="btn btn-default">Go</button>
    </form>
</div>
<div class="col-md-12">
    <div class="col-md-6">
        <table class="table">
            <thead>
                <tr>
                    <th></th><th></th><th>Trade</th><th>PL</th><th>Outperf.</th><th>Alpha</th><th>Win%</th>
                    <th>OP%</th><th>Al.%</th>
                </tr>
            </thead>
            <tbody>
                {% for fund in ['RH','YA','LR'] %}
                
                {% if alpha[fund] is defined and op_hit[fund] is defined %}
                {% if tbldata[fund+'Attr']['long_count'] > 0 %}
                <tr>
                    <td>RH</td>
                    <td>L</td>
                    <td>{{tbldata[fund+'Attr']['long_count']}}</td>
                    <td>{{'{:.2f}%'.format(pl[(fund+'Attr', 'L')])}}</td>
                    <td>{{'{:.2f}%'.format( rhop['L'] if fund == 'RH' else (yaop['L'] if fund=='YA' else (lrop['L'] if fund == 'LR' else 0)))}}</td>
                    <td>{{'{:.2f}%'.format(rhalpha['L'] if fund == 'RH' else (yaalpha['L'] if fund == 'YA' else (lralpha['L'] if fund == 'LR' else 0)))}}</td>
                    <td>{{'{:.0f}%'.format(tbldata[fund+'Attr']['long_ratio']*100)}}</td>
                    <td>{{'{:.0f}%'.format(op_hit[fund]['long_ratio']*100)}}</td>
                    <td>{{'{:.0f}%'.format(alpha[fund]['long_ratio']*100)}}</td>
                </tr>
                {% endif %}

                {% if tbldata.RHAttr.short_count > 0 %}
                <tr>
                    <td>{{ '' if tbldata[fund + 'Attr'].long_count > 0 else fund }}</td>
                    <td>S</td>
                    <td>{{tbldata[fund+'Attr']['short_count']}}</td>
                    <td>{{'{:.2f}%'.format(pl[(fund+'Attr', 'S')])}}</td>
                    <td>{{'{:.2f}%'.format(rhop['S'] if fund=='RH' else (yaop['S'] if fund == 'YA' else (lrop['S'] if fund == 'LR' else 0)))}}</td>
                    <td>{{'{:.2f}%'.format(rhalpha['S'] if fund == 'RH' else (yaalpha['S'] if fund == 'YA' else (lralpha['S'] if fund == 'LR' else 0)))}}</td>
                    <td>{{'{:.0f}%'.format(tbldata[fund + 'Attr']['short_ratio']*100)}}</td>
                    <td>{{'{:.0f}%'.format(op_hit[fund]['short_ratio']*100)}}</td>
                    <td>{{'{:.0f}%'.format(alpha[fund]['short_ratio']*100)}}</td>
                </tr>
                {% endif %}

                {% if tbldata[fund+'Attr']['long_count'] > 0 and tbldata[fund+'Attr']['short_count'] > 0 %}
                <tr>
                    <td></td>
                    <td>Total</td>
                    <td>{{tbldata[fund+'Attr']['long_count'] + tbldata[fund+'Attr']['short_count']}}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>{{'{:.0f}%'.format(tbldata[fund+'Attr']['total_ratio']*100)}}</td>
                    <td>{{'{:.0f}%'.format(op_hit[fund]['total_ratio']*100)}}</td>
                    <td>{{'{:.0f}%'.format(alpha[fund]['total_ratio']*100)}}</td>
                </tr>
                {% endif %}
                {% endif %}
            {% endfor %}
                
            </tbody>
        </table>
    </div>
    
    <div class="col-md-6">
        {{ params['table'] | safe }}
    </div>
</div>

<div class="col-md-12">
        {% if tbldata['RHAttr']['long_count'] > 0 or tbldata['RHAttr']['short_count'] > 0 %}
       <h4>Position Size Chart</h4>
       <div id="position_size_graph"></div> 
       {% endif %}

       {% if tbldata['RHAttr']['long_count'] > 0 or tbldata['RHAttr']['short_count'] > 0 %}
       <h4>Trade Charts</h4>
       <div id="long_price_graph"></div>
       <div id="long_rate_graph"></div>
       {% endif %}
       
</div>
<script src="{{ url_for('static', filename='jquery-2.2.0.min.js') }}"></script>


<!-- wiki display modal -->
<div class="modal fade" id="wikimodal" role="dialog" aria-labelledby="modalTitle">
   <div class="modal-dialog" role="document">
       <div class="modal-content">
            <div class="modal-header">  
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Wiki Comment</h4>
          </div>
          <div class="modal-body">
            ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
       </div>
   </div>
</div>



{% if tbldata['RHAttr']['long_count'] > 0 or tbldata['RHAttr']['short_count'] > 0 %}
  <script>
     long_plot = function() {
     long_price_graph = document.getElementById("long_price_graph");
     long_rate_graph = document.getElementById('long_rate_graph');

    Plotly.plot( long_price_graph, {{params['long_price_graph'].data | safe }}, {{ params['long_price_graph'].layout | safe }});
    Plotly.plot( long_rate_graph, {{params['long_rate_graph'].data | safe }}, {{ params['long_rate_graph'].layout | safe }});
       };
    if (document.readyState === 'complete' || document.readyState !== 'loading') {
        long_plot();
     } else {
        document.addEventListener('DOMContentLoaded', long_plot);
      }
  </script>
{% endif %}

{% if tbldata['RHAttr']['long_count'] > 0 or tbldata['RHAttr']['short_count'] > 0 %}
<script>
    position_plot = function() {
     position_size_graph = document.getElementById("position_size_graph");
    Plotly.plot( position_size_graph , {{params['position_size_graph'].data | safe }}, {{ params['position_size_graph'].layout | safe }});
    };
    if (document.readyState === 'complete' || document.readyState !== 'loading') {
        position_plot();
    } else {
        document.addEventListener('DOMContentLoaded', position_plot);
    }
</script>
{% endif %}

{% if tbldata['RHAttr']['short_count'] > 0 %}
  
{% endif %}





{% endblock %}
